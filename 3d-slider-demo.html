<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3D Scenes Slider</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.css" />
    
    <style>
      body {
        margin: 0;
        padding: 0;
        background: #1a1a1a;
        color: #fff;
        font-family: Arial, sans-serif;
      }

      .swiper {
        width: 100%;
        height: 80vh;
      }
      
      .swiper-slide {
        background: #1a1a1a;
      }
      
      .three-scene {
        width: 100%;
        height: 100%;
      }

      .loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: white;
        z-index: 1000;
      }

      .loading-text {
        margin-bottom: 20px;
        font-size: 1.2em;
      }

      .progress-bar {
        width: 200px;
        height: 4px;
        background: #333;
        border-radius: 2px;
        overflow: hidden;
      }

      .progress {
        width: 0%;
        height: 100%;
        background: #31baeb;
        transition: width 0.3s ease;
      }

      .model-info {
        position: absolute;
        bottom: 20px;
        left: 20px;
        background: rgba(0, 0, 0, 0.7);
        padding: 10px 20px;
        border-radius: 5px;
        z-index: 1;
      }

      .model-info h3 {
        margin: 0;
        color: #31baeb;
      }
    </style>
  </head>
  <body>
    <div class="loading-screen">
      <div class="loading-text">Загрузка сцен...</div>
      <div class="progress-bar">
        <div class="progress"></div>
      </div>
    </div>

    <div class="swiper">
      <div class="swiper-wrapper">
        <div class="swiper-slide">
          <div class="three-scene"></div>
          <div class="model-info">
            <h3>Flamingo</h3>
            <p>Анимированная модель фламинго</p>
          </div>
        </div>
        <div class="swiper-slide">
          <div class="three-scene"></div>
          <div class="model-info">
            <h3>Horse</h3>
            <p>Анимированная модель лошади</p>
          </div>
        </div>
        <div class="swiper-slide">
          <div class="three-scene"></div>
          <div class="model-info">
            <h3>Stork</h3>
            <p>Анимированная модель аиста</p>
          </div>
        </div>
      </div>
      <div class="swiper-pagination"></div>
      <div class="swiper-button-prev"></div>
      <div class="swiper-button-next"></div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.134.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.134.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.134.0/examples/js/libs/stats.min.js"></script>
    
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const loadingScreen = document.querySelector('.loading-screen');
        const progressBar = document.querySelector('.progress');
        const loadingText = document.querySelector('.loading-text');

        // Инициализация Swiper
        const swiper = new Swiper('.swiper', {
          loop: true,
          speed: 1000,
          effect: 'fade',
          fadeEffect: {
            crossFade: true
          },
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });

        // Массив для хранения сцен
        const scenes = [];
        const totalModels = 3;
        let loadedModels = 0;

        // Модели из Three.js examples
        const models = [
          {
            url: 'https://threejs.org/examples/models/gltf/Flamingo.glb',
            scale: 0.35,
            position: { x: 0, y: 0, z: 0 }
          },
          {
            url: 'https://threejs.org/examples/models/gltf/Horse.glb',
            scale: 0.01,
            position: { x: 0, y: 0, z: 0 }
          },
          {
            url: 'https://threejs.org/examples/models/gltf/Stork.glb',
            scale: 0.35,
            position: { x: 0, y: 0, z: 0 }
          }
        ];

        document.querySelectorAll('.three-scene').forEach((element, index) => {
          const scene = new THREE.Scene();
          scene.background = new THREE.Color(0x1a1a1a);
          
          const camera = new THREE.PerspectiveCamera(
            45,
            element.clientWidth / element.clientHeight,
            0.25,
            100
          );
          camera.position.set(0, 2, 5);

          const renderer = new THREE.WebGLRenderer({ antialias: true });
          renderer.setPixelRatio(window.devicePixelRatio);
          renderer.setSize(element.clientWidth, element.clientHeight);
          renderer.outputEncoding = THREE.sRGBEncoding;
          element.appendChild(renderer.domElement);

          // Освещение
          const hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444);
          hemiLight.position.set(0, 20, 0);
          scene.add(hemiLight);

          const dirLight = new THREE.DirectionalLight(0xffffff);
          dirLight.position.set(0, 20, 10);
          scene.add(dirLight);

          // Контролы
          const controls = new THREE.OrbitControls(camera, renderer.domElement);
          controls.enableDamping = true;
          controls.dampingFactor = 0.05;
          controls.screenSpacePanning = false;
          controls.minDistance = 3;
          controls.maxDistance = 10;

          // Загрузка модели
          const loader = new THREE.GLTFLoader();
          
          loader.load(models[index].url, function(gltf) {
            const model = gltf.scene;
            model.scale.setScalar(models[index].scale);
            model.position.set(
              models[index].position.x,
              models[index].position.y,
              models[index].position.z
            );
            scene.add(model);

            // Настройка анимации
            const mixer = new THREE.AnimationMixer(model);
            const clips = gltf.animations;
            clips.forEach(clip => {
              mixer.clipAction(clip).play();
            });

            loadedModels++;
            progressBar.style.width = (loadedModels / totalModels * 100) + '%';
            
            if (loadedModels === totalModels) {
              loadingScreen.style.display = 'none';
            }

            // Создаем объект сцены
            const sceneObj = {
              scene,
              camera,
              renderer,
              controls,
              mixer,
              clock: new THREE.Clock(),
              animate: function() {
                if (!document.hidden && swiper.activeIndex === index) {
                  const delta = this.clock.getDelta();
                  if (this.mixer) this.mixer.update(delta);
                  this.controls.update();
                  this.renderer.render(this.scene, this.camera);
                }
              }
            };

            scenes.push(sceneObj);
          }, 
          function(xhr) {
            const progress = xhr.loaded / xhr.total;
            const totalProgress = ((loadedModels + progress) / totalModels * 100).toFixed(0);
            loadingText.textContent = `Загрузка сцен... ${totalProgress}%`;
          },
          function(error) {
            console.error('Ошибка загрузки:', error);
            loadedModels++;
            if (loadedModels === totalModels) {
              loadingScreen.style.display = 'none';
            }
          });
        });

        // Анимационный цикл
        function animate() {
          requestAnimationFrame(animate);
          scenes.forEach(scene => scene.animate());
        }
        animate();

        // Обработка изменения размера окна
        window.addEventListener('resize', function() {
          scenes.forEach(scene => {
            const element = scene.renderer.domElement.parentElement;
            const width = element.clientWidth;
            const height = element.clientHeight;
            
            scene.camera.aspect = width / height;
            scene.camera.updateProjectionMatrix();
            scene.renderer.setSize(width, height);
          });
        });
      });
    </script>
  </body>
</html>